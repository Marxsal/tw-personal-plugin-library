{"name":"Searchable TOC","title":"$:/plugins/MAS/TOC-Search","description":"Creates a searchable TOC","author":"marxsal","version":"0.0.1","core-version":">=5.1.23","source":"https://marxsal.github.io/tw-personal-plugin-library","list":"readme","dependents":"","plugin-type":"plugin","type":"application/json","text":"{\"tiddlers\":{\"$:/plugins/MAS/TOC-Search/StyleSheet\":{\"title\":\"$:/plugins/MAS/TOC-Search/StyleSheet\",\"text\":\".mas-taglist li.toc-item {\\nlist-style-type: none ;\\n}\\n.mas-taglist  ol.tc-toc {\\npadding-left: 10px;\\n}\\n\\nspan.mas-toc-search-icon .tc-image-button {\\nheight: 1em ;\\nvertical-align: -2px ;\\n}\\n\",\"created\":\"20200913213754291\",\"creator\":\"MAS\",\"modified\":\"20211005021918598\",\"modifier\":\"MAS\",\"tags\":\"$:/tags/Stylesheet\",\"type\":\"text/css\"},\"$:/config/shortcuts/toc-find\":{\"title\":\"$:/config/shortcuts/toc-find\",\"created\":\"20210930153034301\",\"creator\":\"MAS\",\"modified\":\"20211005000956017\",\"modifier\":\"MAS\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"Enter\"},\"$:/config/shortcuts/toc-reset\":{\"title\":\"$:/config/shortcuts/toc-reset\",\"created\":\"20210930164216792\",\"creator\":\"MAS\",\"modified\":\"20211005000956034\",\"modifier\":\"MAS\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"Escape\"},\"$:/plugins/MAS/TOC-Search/Macros\":{\"title\":\"$:/plugins/MAS/TOC-Search/Macros\",\"created\":\"20210930182416469\",\"creator\":\"MAS\",\"keep-rev\":\"5\",\"modified\":\"20211005031130508\",\"modifier\":\"MAS\",\"tags\":\"$:/tags/Macro\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\\\define search-and-toc(tid)\\n<$vars \\nqnum=\\\"\\\"\\\"$(qualify)$\\\"\\\"\\\"\\nmas-search-tiddler=\\\"\\\"\\\"$:/state/mas/search$(qualify)$\\\"\\\"\\\"\\nmas-search-tiddler-results=\\\"\\\"\\\"$:/state/mas/search$(qualify)$-list\\\"\\\"\\\"\\n>\\n<$macrocall $name=\\\"mas-search-box\\\" />\\n<hr/>\\n<div class=\\\"mas-taglist\\\">\\n<$macrocall $name=\\\"toc-selective-expandable\\\" tag=<<currentTiddler>> sort=\\\"]:intersection[list<mas-search-tiddler-results>]+[sort[]\\\"  />\\n</div>\\n</$vars>\\n\\\\end\\n\"},\"$:/plugins/MAS/TOC-Search/readme\":{\"title\":\"$:/plugins/MAS/TOC-Search/readme\",\"created\":\"20211005015439529\",\"modified\":\"20211005031320885\",\"tags\":\"\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\nThis simple tool creates a standard expandable TOC rooted on the name of the current tiddler. Unlike a regular TOC, it can be searched. The first time you use it, you may need to click on the large \\\"X\\\" to set up the TOC. After that you can type your search term in the provided box and either type `<enter>` or click the search (<span class=\\\"mas-toc-search-icon\\\">{{$:/core/images/advanced-search-button}}</span>) icon. The TOC will be searched, and any branches matching the search term will be opened.\\n\\nThis plugin requires Bimlas' `kin-filter` plugin, available [ext[here|https://gitlab.com/bimlas/tw5-kin-filter]].\\n\\nTo use, just insert `<<search-and-toc>>` into a tiddler that you wish to form the root of a new searchable tree. The first time you use it you will need to initialize it by pressing `<esc>` or clicking the large \\\"X\\\".\\n\"},\"$:/plugins/MAS/TOC-Search/Macros/Search Box\":{\"title\":\"$:/plugins/MAS/TOC-Search/Macros/Search Box\",\"_toc\":\"hit\",\"created\":\"20210311181204933\",\"creator\":\"MAS\",\"keep-rev\":\"5\",\"modified\":\"20211005031048002\",\"modifier\":\"MAS\",\"tags\":\"$:/tags/Macro\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\\\whitespace trim\\n\\\\define actions-toc-find() \\n<!-- $action-setfield $tiddler=\\\"whoami\\\" text=\\\"$(mas-search-tiddler)$\\\" / -->\\n<$action-setfield $tiddler=\\\"$(mas-search-tiddler-results)$\\\" list=\\\"\\\" $timestamp=\\\"no\\\" />\\n\\n<$list filter=\\\"[kin::to:<currentTiddler>search{$(mas-search-tiddler)$}kin::from:[]]\\\" variable=term>\\n<$action-listops $tiddler=\\\"$(mas-search-tiddler-results)$\\\" $subfilter=\\\"[<term>]\\\"/>\\n<$vars stem={{{ [<term>addprefix[-]addsuffix<qnum>] }}} >\\n\\n<$action-setfield \\n$tiddler={{{[[$(currentTiddler)$]addprefix[$:/state/toc/]addsuffix<stem>]}}}\\ntext=\\\"open\\\"/>\\n\\n</$list>\\n</$vars>\\n\\\\end\\n\\n\\\\define actions-toc-reset()\\n<$action-setfield $tiddler=\\\"$(mas-search-tiddler-results)$\\\" list=\\\"\\\" $timestamp=\\\"no\\\" />\\n<$list filter=\\\"[prefix[$:/state/toc/$(currentTiddler)$]]\\\">\\n  <$action-deletetiddler $tiddler=<<currentTiddler>> />\\n</$list>\\n<$list filter=\\\"[kin::to:<currentTiddler>]\\\" variable=term>\\n<!-- $action-setfield $tiddler=<<term>> _toc=\\\"hit\\\" $timestamp=\\\"no\\\" -->\\n<$action-listops $tiddler=\\\"$(mas-search-tiddler-results)$\\\" $subfilter=\\\"[<term>]\\\"/>\\n</$list>\\n\\\\end\\n\\n\\\\define mas-search-box()\\n<div class=\\\"tc-sidebar-lists tc-sidebar-search\\\">\\n\\n<div class=\\\"tc-search\\\">\\n<$keyboard key=\\\"((toc-reset))\\\" actions=\\\"\\\"\\\"<<actions-toc-reset>>\\\"\\\"\\\">\\n<$keyboard key=\\\"((toc-find))\\\" actions=\\\"\\\"\\\"<<actions-toc-find>>\\\"\\\"\\\">\\n<$edit-text tiddler=\\\"$(mas-search-tiddler)$\\\" type=\\\"search\\\" tag=\\\"input\\\" focus={{$:/config/Search/AutoFocus}}  class=\\\"tc-popup-handle\\\"/>\\n</$keyboard>\\n</$keyboard>\\n<$button tooltip=\\\"Search TOC\\\" class=\\\"tc-btn-invisible\\\" actions=<<actions-toc-find>>>\\n{{$:/core/images/advanced-search-button}}\\n</$button>\\n<$button tooltip=\\\"Reset TOC \\\" class=\\\"tc-btn-invisible\\\" actions=<<actions-toc-reset>>>\\n{{$:/core/images/close-button}}\\n</$button>\\n</div>\\n\\n</div>\\n\\\\end\\n\\\\define old-code()\\n<$reveal tag=\\\"div\\\" class=\\\"tc-block-dropdown-wrapper\\\" state=\\\"$tid$\\\" type=\\\"nomatch\\\" text=\\\"\\\">\\n\\n<$list filter=\\\"[{$tid$}minlength{$:/config/Search/MinLength}limit[1]]\\\" emptyMessage=\\\"\\\"\\\"<div class=\\\"tc-search-results\\\">{{$:/language/Search/Search/TooShort}}</div>\\\"\\\"\\\" variable=\\\"listItem\\\">\\n\\n</$list>\\n\\n</$reveal>\\n\\\\end\\n\"}}}"}